#!/bin/sh
################################################################################
##      Copyright (C) 2020        Alejandro Colomar Andr√©s                    ##
##      SPDX-License-Identifier:  GPL-2.0-only                                ##
################################################################################


################################################################################
##	functions							      ##
################################################################################
copy_run()
{

	cp -avr	./run/configs	/run/
	cp -avr	./run/secrets	/run/
}

deploy_stack()
{
	local	swarm_name=$1

	local	path="etc/docker/swarm"
	local	fname="docker-compose.yaml"

	docker stack deploy -c ${path}/${fname} ${swarm_name}

}


################################################################################
##	main								      ##
################################################################################
main()
{
	local	swarm_name=$1

	copy_run
	deploy_stack	${swarm_name}
}


################################################################################
##	run								      ##
################################################################################
params=1

if [ "$#" -ne ${params} ]; then
	echo	"Illegal number of parameters (Requires ${params})"
	exit	64	## EX_USAGE /* command line usage error */
fi

main	$1


################################################################################
##	end of file							      ##
################################################################################
